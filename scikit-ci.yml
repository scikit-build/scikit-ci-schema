

pre_install:

  appveyor:
    cmd:
      - python ci/appveyor/patch_vs2008.py
      - python ci/appveyor/download_run_with_visual_studio.py

    environment:
      - RUN_ENV: ci/appveyor/run-with-visual-studio.cmd

  travis:
    osx:
      cmd:
        - brew update
        - brew outdated pyenv || brew upgrade pyenv
        - eval "$( penv init -)"
        - pyenv install ${PYTHONVERSION}
        - pyenv local ${PYTHONVERSION}
        - echo "'Python version:'"
        - python -c "import sys, struct; print(sys.version); print('{}-bit'.format(struct.calcsize('P') * 8))"
      environment:
        - RUN_ENV: eval("$( pyenv init - )")

install:

  all:
    - python ci/install_cmake.py 3.6.2
    - RUN_ENV: python -m pip install --disable-pip-version-check --upgrade pip
    - RUN_ENV: python -m pip install -r requirements.txt
    - RUN_ENV: python -m pip install -r requirements-dev.txt

  circleci:
    - sudo apt-get update
    - sudo apt-get install fortran

pre_build:
  - RUN_ENV: python -m flake8 -v

build:
  - RUN_ENV: python setup.py build

test:
  - RUN_ENV: python setup.py test  # --addopts EXTRA_TEST_ARGS

after_test:
  all:
    - RUN_ENV: codecov -X gcov --required --file ./tests/coverage.xml
    - RUN_ENV: python setup.py bdist_wheel

  appveyor:
    - RUN_ENV: python setup.py bdist_wininst
    - RUN_ENV: python setup.py bdist_msi

